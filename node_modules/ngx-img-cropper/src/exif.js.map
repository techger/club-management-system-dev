{"version":3,"file":"exif.js","sourceRoot":"","sources":["../../src/exif.ts"],"names":[],"mappings":"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","sourcesContent":["export class Fraction extends Number {\r\n  numerator: number;\r\n  denominator: number;\r\n}\r\n\r\nexport interface IImageExtended extends HTMLImageElement {\r\n  exifdata: any;\r\n  iptcdata: any;\r\n}\r\n\r\n// Console debug wrapper that makes code looks a little bit cleaner\r\nexport class Debug {\r\n  public static log(...args: any[]) {\r\n    if (Exif.debug) {\r\n      console.log(args);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Exif {\r\n  public static debug: boolean = false;\r\n\r\n  public static IptcFieldMap: any = {\r\n    0x78: \"caption\",\r\n    0x6e: \"credit\",\r\n    0x19: \"keywords\",\r\n    0x37: \"dateCreated\",\r\n    0x50: \"byline\",\r\n    0x55: \"bylineTitle\",\r\n    0x7a: \"captionWriter\",\r\n    0x69: \"headline\",\r\n    0x74: \"copyright\",\r\n    0x0f: \"category\"\r\n  };\r\n\r\n  public static Tags: any = {\r\n    // version tags\r\n    0x9000: \"ExifVersion\", // EXIF version\r\n    0xa000: \"FlashpixVersion\", // Flashpix format version\r\n\r\n    // colorspace tags\r\n    0xa001: \"ColorSpace\", // Color space information tag\r\n\r\n    // image configuration\r\n    0xa002: \"PixelXDimension\", // Valid width of meaningful image\r\n    0xa003: \"PixelYDimension\", // Valid height of meaningful image\r\n    0x9101: \"ComponentsConfiguration\", // Information about channels\r\n    0x9102: \"CompressedBitsPerPixel\", // Compressed bits per pixel\r\n\r\n    // user information\r\n    0x927c: \"MakerNote\", // Any desired information written by the manufacturer\r\n    0x9286: \"UserComment\", // Comments by user\r\n\r\n    // related file\r\n    0xa004: \"RelatedSoundFile\", // Name of related sound file\r\n\r\n    // date and time\r\n    0x9003: \"DateTimeOriginal\", // Date and time when the original image was generated\r\n    0x9004: \"DateTimeDigitized\", // Date and time when the image was stored digitally\r\n    0x9290: \"SubsecTime\", // Fractions of seconds for DateTime\r\n    0x9291: \"SubsecTimeOriginal\", // Fractions of seconds for DateTimeOriginal\r\n    0x9292: \"SubsecTimeDigitized\", // Fractions of seconds for DateTimeDigitized\r\n\r\n    // picture-taking conditions\r\n    0x829a: \"ExposureTime\", // Exposure time (in seconds)\r\n    0x829d: \"FNumber\", // F number\r\n    0x8822: \"ExposureProgram\", // Exposure program\r\n    0x8824: \"SpectralSensitivity\", // Spectral sensitivity\r\n    0x8827: \"ISOSpeedRatings\", // ISO speed rating\r\n    0x8828: \"OECF\", // Optoelectric conversion factor\r\n    0x9201: \"ShutterSpeedValue\", // Shutter speed\r\n    0x9202: \"ApertureValue\", // Lens aperture\r\n    0x9203: \"BrightnessValue\", // Value of brightness\r\n    0x9204: \"ExposureBias\", // Exposure bias\r\n    0x9205: \"MaxApertureValue\", // Smallest F number of lens\r\n    0x9206: \"SubjectDistance\", // Distance to subject in meters\r\n    0x9207: \"MeteringMode\", // Metering mode\r\n    0x9208: \"LightSource\", // Kind of light source\r\n    0x9209: \"Flash\", // Flash status\r\n    0x9214: \"SubjectArea\", // Location and area of main subject\r\n    0x920a: \"FocalLength\", // Focal length of the lens in mm\r\n    0xa20b: \"FlashEnergy\", // Strobe energy in BCPS\r\n    0xa20c: \"SpatialFrequencyResponse\", //\r\n    0xa20e: \"FocalPlaneXResolution\", // Number of pixels in width direction per FocalPlaneResolutionUnit\r\n    0xa20f: \"FocalPlaneYResolution\", // Number of pixels in height direction per FocalPlaneResolutionUnit\r\n    0xa210: \"FocalPlaneResolutionUnit\", // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\r\n    0xa214: \"SubjectLocation\", // Location of subject in image\r\n    0xa215: \"ExposureIndex\", // Exposure index selected on camera\r\n    0xa217: \"SensingMethod\", // Image sensor type\r\n    0xa300: \"FileSource\", // Image source (3 == DSC)\r\n    0xa301: \"SceneType\", // Scene type (1 == directly photographed)\r\n    0xa302: \"CFAPattern\", // Color filter array geometric pattern\r\n    0xa401: \"CustomRendered\", // Special processing\r\n    0xa402: \"ExposureMode\", // Exposure mode\r\n    0xa403: \"WhiteBalance\", // 1 = auto white balance, 2 = manual\r\n    0xa404: \"DigitalZoomRation\", // Digital zoom ratio\r\n    0xa405: \"FocalLengthIn35mmFilm\", // Equivalent foacl length assuming 35mm film camera (in mm)\r\n    0xa406: \"SceneCaptureType\", // Type of scene\r\n    0xa407: \"GainControl\", // Degree of overall image gain adjustment\r\n    0xa408: \"Contrast\", // Direction of contrast processing applied by camera\r\n    0xa409: \"Saturation\", // Direction of saturation processing applied by camera\r\n    0xa40a: \"Sharpness\", // Direction of sharpness processing applied by camera\r\n    0xa40b: \"DeviceSettingDescription\", //\r\n    0xa40c: \"SubjectDistanceRange\", // Distance to subject\r\n\r\n    // other tags\r\n    0xa005: \"InteroperabilityIFDPointer\",\r\n    0xa420: \"ImageUniqueID\" // Identifier assigned uniquely to each image\r\n  };\r\n\r\n  public static TiffTags: any = {\r\n    0x0100: \"ImageWidth\",\r\n    0x0101: \"ImageHeight\",\r\n    0x8769: \"ExifIFDPointer\",\r\n    0x8825: \"GPSInfoIFDPointer\",\r\n    0xa005: \"InteroperabilityIFDPointer\",\r\n    0x0102: \"BitsPerSample\",\r\n    0x0103: \"Compression\",\r\n    0x0106: \"PhotometricInterpretation\",\r\n    0x0112: \"Orientation\",\r\n    0x0115: \"SamplesPerPixel\",\r\n    0x011c: \"PlanarConfiguration\",\r\n    0x0212: \"YCbCrSubSampling\",\r\n    0x0213: \"YCbCrPositioning\",\r\n    0x011a: \"XResolution\",\r\n    0x011b: \"YResolution\",\r\n    0x0128: \"ResolutionUnit\",\r\n    0x0111: \"StripOffsets\",\r\n    0x0116: \"RowsPerStrip\",\r\n    0x0117: \"StripByteCounts\",\r\n    0x0201: \"JPEGInterchangeFormat\",\r\n    0x0202: \"JPEGInterchangeFormatLength\",\r\n    0x012d: \"TransferFunction\",\r\n    0x013e: \"WhitePoint\",\r\n    0x013f: \"PrimaryChromaticities\",\r\n    0x0211: \"YCbCrCoefficients\",\r\n    0x0214: \"ReferenceBlackWhite\",\r\n    0x0132: \"DateTime\",\r\n    0x010e: \"ImageDescription\",\r\n    0x010f: \"Make\",\r\n    0x0110: \"Model\",\r\n    0x0131: \"Software\",\r\n    0x013b: \"Artist\",\r\n    0x8298: \"Copyright\"\r\n  };\r\n\r\n  public static GPSTags: any = {\r\n    0x0000: \"GPSVersionID\",\r\n    0x0001: \"GPSLatitudeRef\",\r\n    0x0002: \"GPSLatitude\",\r\n    0x0003: \"GPSLongitudeRef\",\r\n    0x0004: \"GPSLongitude\",\r\n    0x0005: \"GPSAltitudeRef\",\r\n    0x0006: \"GPSAltitude\",\r\n    0x0007: \"GPSTimeStamp\",\r\n    0x0008: \"GPSSatellites\",\r\n    0x0009: \"GPSStatus\",\r\n    0x000a: \"GPSMeasureMode\",\r\n    0x000b: \"GPSDOP\",\r\n    0x000c: \"GPSSpeedRef\",\r\n    0x000d: \"GPSSpeed\",\r\n    0x000e: \"GPSTrackRef\",\r\n    0x000f: \"GPSTrack\",\r\n    0x0010: \"GPSImgDirectionRef\",\r\n    0x0011: \"GPSImgDirection\",\r\n    0x0012: \"GPSMapDatum\",\r\n    0x0013: \"GPSDestLatitudeRef\",\r\n    0x0014: \"GPSDestLatitude\",\r\n    0x0015: \"GPSDestLongitudeRef\",\r\n    0x0016: \"GPSDestLongitude\",\r\n    0x0017: \"GPSDestBearingRef\",\r\n    0x0018: \"GPSDestBearing\",\r\n    0x0019: \"GPSDestDistanceRef\",\r\n    0x001a: \"GPSDestDistance\",\r\n    0x001b: \"GPSProcessingMethod\",\r\n    0x001c: \"GPSAreaInformation\",\r\n    0x001d: \"GPSDateStamp\",\r\n    0x001e: \"GPSDifferential\"\r\n  };\r\n\r\n  public static StringValues: any = {\r\n    ExposureProgram: {\r\n      0: \"Not defined\",\r\n      1: \"Manual\",\r\n      2: \"Normal program\",\r\n      3: \"Aperture priority\",\r\n      4: \"Shutter priority\",\r\n      5: \"Creative program\",\r\n      6: \"Action program\",\r\n      7: \"Portrait mode\",\r\n      8: \"Landscape mode\"\r\n    },\r\n    MeteringMode: {\r\n      0: \"Unknown\",\r\n      1: \"Average\",\r\n      2: \"CenterWeightedAverage\",\r\n      3: \"Spot\",\r\n      4: \"MultiSpot\",\r\n      5: \"Pattern\",\r\n      6: \"Partial\",\r\n      255: \"Other\"\r\n    },\r\n    LightSource: {\r\n      0: \"Unknown\",\r\n      1: \"Daylight\",\r\n      2: \"Fluorescent\",\r\n      3: \"Tungsten (incandescent light)\",\r\n      4: \"Flash\",\r\n      9: \"Fine weather\",\r\n      10: \"Cloudy weather\",\r\n      11: \"Shade\",\r\n      12: \"Daylight fluorescent (D 5700 - 7100K)\",\r\n      13: \"Day white fluorescent (N 4600 - 5400K)\",\r\n      14: \"Cool white fluorescent (W 3900 - 4500K)\",\r\n      15: \"White fluorescent (WW 3200 - 3700K)\",\r\n      17: \"Standard light A\",\r\n      18: \"Standard light B\",\r\n      19: \"Standard light C\",\r\n      20: \"D55\",\r\n      21: \"D65\",\r\n      22: \"D75\",\r\n      23: \"D50\",\r\n      24: \"ISO studio tungsten\",\r\n      255: \"Other\"\r\n    },\r\n    Flash: {\r\n      0x0000: \"Flash did not fire\",\r\n      0x0001: \"Flash fired\",\r\n      0x0005: \"Strobe return light not detected\",\r\n      0x0007: \"Strobe return light detected\",\r\n      0x0009: \"Flash fired, compulsory flash mode\",\r\n      0x000d: \"Flash fired, compulsory flash mode, return light not detected\",\r\n      0x000f: \"Flash fired, compulsory flash mode, return light detected\",\r\n      0x0010: \"Flash did not fire, compulsory flash mode\",\r\n      0x0018: \"Flash did not fire, auto mode\",\r\n      0x0019: \"Flash fired, auto mode\",\r\n      0x001d: \"Flash fired, auto mode, return light not detected\",\r\n      0x001f: \"Flash fired, auto mode, return light detected\",\r\n      0x0020: \"No flash function\",\r\n      0x0041: \"Flash fired, red-eye reduction mode\",\r\n      0x0045: \"Flash fired, red-eye reduction mode, return light not detected\",\r\n      0x0047: \"Flash fired, red-eye reduction mode, return light detected\",\r\n      0x0049: \"Flash fired, compulsory flash mode, red-eye reduction mode\",\r\n      0x004d: \"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",\r\n      0x004f: \"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",\r\n      0x0059: \"Flash fired, auto mode, red-eye reduction mode\",\r\n      0x005d: \"Flash fired, auto mode, return light not detected, red-eye reduction mode\",\r\n      0x005f: \"Flash fired, auto mode, return light detected, red-eye reduction mode\"\r\n    },\r\n    SensingMethod: {\r\n      1: \"Not defined\",\r\n      2: \"One-chip color area sensor\",\r\n      3: \"Two-chip color area sensor\",\r\n      4: \"Three-chip color area sensor\",\r\n      5: \"Color sequential area sensor\",\r\n      7: \"Trilinear sensor\",\r\n      8: \"Color sequential linear sensor\"\r\n    },\r\n    SceneCaptureType: {\r\n      0: \"Standard\",\r\n      1: \"Landscape\",\r\n      2: \"Portrait\",\r\n      3: \"Night scene\"\r\n    },\r\n    SceneType: {\r\n      1: \"Directly photographed\"\r\n    },\r\n    CustomRendered: {\r\n      0: \"Normal process\",\r\n      1: \"Custom process\"\r\n    },\r\n    WhiteBalance: {\r\n      0: \"Auto white balance\",\r\n      1: \"Manual white balance\"\r\n    },\r\n    GainControl: {\r\n      0: \"None\",\r\n      1: \"Low gain up\",\r\n      2: \"High gain up\",\r\n      3: \"Low gain down\",\r\n      4: \"High gain down\"\r\n    },\r\n    Contrast: {\r\n      0: \"Normal\",\r\n      1: \"Soft\",\r\n      2: \"Hard\"\r\n    },\r\n    Saturation: {\r\n      0: \"Normal\",\r\n      1: \"Low saturation\",\r\n      2: \"High saturation\"\r\n    },\r\n    Sharpness: {\r\n      0: \"Normal\",\r\n      1: \"Soft\",\r\n      2: \"Hard\"\r\n    },\r\n    SubjectDistanceRange: {\r\n      0: \"Unknown\",\r\n      1: \"Macro\",\r\n      2: \"Close view\",\r\n      3: \"Distant view\"\r\n    },\r\n    FileSource: {\r\n      3: \"DSC\"\r\n    },\r\n\r\n    Components: {\r\n      0: \"\",\r\n      1: \"Y\",\r\n      2: \"Cb\",\r\n      3: \"Cr\",\r\n      4: \"R\",\r\n      5: \"G\",\r\n      6: \"B\"\r\n    }\r\n  };\r\n\r\n  public static addEvent(\r\n    element: EventTarget | any,\r\n    event: string,\r\n    handler: EventListener\r\n  ) {\r\n    if (element.addEventListener) {\r\n      element.addEventListener(event, handler, false);\r\n    } else {\r\n      // Hello, IE!\r\n      if (element.attachEvent) {\r\n        element.attachEvent(\"on\" + event, handler);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static imageHasData(img: IImageExtended) {\r\n    return !!img.exifdata;\r\n  }\r\n\r\n  public static base64ToArrayBuffer(base64: string): ArrayBuffer {\r\n    base64 = base64.replace(/^data:([^;]+);base64,/gim, \"\");\r\n    let binary: string = atob(base64);\r\n    let len: number = binary.length;\r\n    let buffer: ArrayBuffer = new ArrayBuffer(len);\r\n    let view: Uint8Array = new Uint8Array(buffer);\r\n    for (let i = 0; i < len; i++) {\r\n      view[i] = binary.charCodeAt(i);\r\n    }\r\n    return buffer;\r\n  }\r\n\r\n  public static objectURLToBlob(url: string, callback: Function) {\r\n    let http: XMLHttpRequest = new XMLHttpRequest();\r\n    http.open(\"GET\", url, true);\r\n    http.responseType = \"blob\";\r\n    http.onload = function() {\r\n      if (http.status === 200 || http.status === 0) {\r\n        callback(http.response);\r\n      }\r\n    };\r\n    http.send();\r\n  }\r\n\r\n  public static getImageData(\r\n    img: IImageExtended | Blob | File,\r\n    callback: Function\r\n  ) {\r\n    function handleBinaryFile(binFile: ArrayBuffer) {\r\n      let data = Exif.findEXIFinJPEG(binFile);\r\n      let iptcdata = Exif.findIPTCinJPEG(binFile);\r\n      (img as IImageExtended).exifdata = data || {};\r\n      (img as IImageExtended).iptcdata = iptcdata || {};\r\n      if (callback) {\r\n        callback.call(img);\r\n      }\r\n    }\r\n\r\n    if (\"src\" in img && (img as IImageExtended).src) {\r\n      if (/^data:/i.test((img as IImageExtended).src)) {\r\n        // Data URI\r\n        let arrayBuffer = Exif.base64ToArrayBuffer((img as IImageExtended).src);\r\n        handleBinaryFile(arrayBuffer);\r\n      } else {\r\n        if (/^blob:/i.test((img as IImageExtended).src)) {\r\n          // Object URL\r\n          let fileReader = new FileReader();\r\n          fileReader.onload = (e: any) => {\r\n            handleBinaryFile(e.target.result);\r\n          };\r\n          Exif.objectURLToBlob((img as IImageExtended).src, (blob: Blob) => {\r\n            fileReader.readAsArrayBuffer(blob);\r\n          });\r\n        } else {\r\n          let http = new XMLHttpRequest();\r\n          http.onload = function() {\r\n            if (http.status === 200 || http.status === 0) {\r\n              handleBinaryFile(http.response);\r\n            } else {\r\n              throw \"Could not load image\";\r\n            }\r\n          };\r\n          http.open(\"GET\", (img as IImageExtended).src, true);\r\n          http.responseType = \"arraybuffer\";\r\n          http.send(null);\r\n        }\r\n      }\r\n    } else {\r\n      if (FileReader && (img instanceof Blob || img instanceof File)) {\r\n        let fileReader = new FileReader();\r\n        fileReader.onload = function(e: any) {\r\n          Debug.log(\"Got file of length \" + e.target.result.byteLength);\r\n          handleBinaryFile(e.target.result);\r\n        };\r\n\r\n        fileReader.readAsArrayBuffer(img);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static findEXIFinJPEG(file: ArrayBuffer) {\r\n    let dataView = new DataView(file);\r\n\r\n    Debug.log(\"Got file of length \" + file.byteLength);\r\n    if (dataView.getUint8(0) !== 0xff || dataView.getUint8(1) !== 0xd8) {\r\n      Debug.log(\"Not a valid JPEG\");\r\n      return false; // not a valid jpeg\r\n    }\r\n\r\n    let offset = 2;\r\n    let length: number = file.byteLength;\r\n    let marker: number;\r\n\r\n    while (offset < length) {\r\n      if (dataView.getUint8(offset) !== 0xff) {\r\n        Debug.log(\r\n          \"Not a valid marker at offset \" +\r\n            offset +\r\n            \", found: \" +\r\n            dataView.getUint8(offset)\r\n        );\r\n        return false; // not a valid marker, something is wrong\r\n      }\r\n\r\n      marker = dataView.getUint8(offset + 1);\r\n      Debug.log(marker);\r\n\r\n      // we could implement handling for other markers here,\r\n      // but we're only looking for 0xFFE1 for EXIF data\r\n      if (marker === 225) {\r\n        Debug.log(\"Found 0xFFE1 marker\");\r\n        return Exif.readEXIFData(dataView, offset + 4); // , dataView.getUint16(offset + 2) - 2);\r\n        // offset += 2 + file.getShortAt(offset+2, true);\r\n      } else {\r\n        offset += 2 + dataView.getUint16(offset + 2);\r\n      }\r\n    }\r\n  }\r\n\r\n  public static findIPTCinJPEG(file: ArrayBuffer) {\r\n    let dataView = new DataView(file);\r\n\r\n    Debug.log(\"Got file of length \" + file.byteLength);\r\n    if (dataView.getUint8(0) !== 0xff || dataView.getUint8(1) !== 0xd8) {\r\n      Debug.log(\"Not a valid JPEG\");\r\n      return false; // not a valid jpeg\r\n    }\r\n\r\n    let offset = 2;\r\n    let length = file.byteLength;\r\n\r\n    let isFieldSegmentStart = function(_dataView: DataView, _offset: number) {\r\n      return (\r\n        _dataView.getUint8(_offset) === 0x38 &&\r\n        _dataView.getUint8(_offset + 1) === 0x42 &&\r\n        _dataView.getUint8(_offset + 2) === 0x49 &&\r\n        _dataView.getUint8(_offset + 3) === 0x4d &&\r\n        _dataView.getUint8(_offset + 4) === 0x04 &&\r\n        _dataView.getUint8(_offset + 5) === 0x04\r\n      );\r\n    };\r\n\r\n    while (offset < length) {\r\n      if (isFieldSegmentStart(dataView, offset)) {\r\n        // Get the length of the name header (which is padded to an even number of bytes)\r\n        let nameHeaderLength = dataView.getUint8(offset + 7);\r\n        if (nameHeaderLength % 2 !== 0) {\r\n          nameHeaderLength += 1;\r\n        }\r\n        // Check for pre photoshop 6 format\r\n        if (nameHeaderLength === 0) {\r\n          // Always 4\r\n          nameHeaderLength = 4;\r\n        }\r\n\r\n        let startOffset = offset + 8 + nameHeaderLength;\r\n        let sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\r\n\r\n        return Exif.readIPTCData(file, startOffset, sectionLength);\r\n      }\r\n\r\n      // Not the marker, continue searching\r\n      offset++;\r\n    }\r\n  }\r\n\r\n  public static readIPTCData(\r\n    file: ArrayBuffer,\r\n    startOffset: number,\r\n    sectionLength: number\r\n  ) {\r\n    let dataView = new DataView(file);\r\n    let data: any = {};\r\n    let fieldValue: any,\r\n      fieldName: string,\r\n      dataSize: number,\r\n      segmentType: any,\r\n      segmentSize: number;\r\n    let segmentStartPos = startOffset;\r\n    while (segmentStartPos < startOffset + sectionLength) {\r\n      if (\r\n        dataView.getUint8(segmentStartPos) === 0x1c &&\r\n        dataView.getUint8(segmentStartPos + 1) === 0x02\r\n      ) {\r\n        segmentType = dataView.getUint8(segmentStartPos + 2);\r\n        if (segmentType in Exif.IptcFieldMap) {\r\n          dataSize = dataView.getInt16(segmentStartPos + 3);\r\n          segmentSize = dataSize + 5;\r\n          fieldName = Exif.IptcFieldMap[segmentType];\r\n          fieldValue = Exif.getStringFromDB(\r\n            dataView,\r\n            segmentStartPos + 5,\r\n            dataSize\r\n          );\r\n          // Check if we already stored a value with this name\r\n          if (data.hasOwnProperty(fieldName)) {\r\n            // Value already stored with this name, create multivalue field\r\n            if (data[fieldName] instanceof Array) {\r\n              data[fieldName].push(fieldValue);\r\n            } else {\r\n              data[fieldName] = [data[fieldName], fieldValue];\r\n            }\r\n          } else {\r\n            data[fieldName] = fieldValue;\r\n          }\r\n        }\r\n      }\r\n      segmentStartPos++;\r\n    }\r\n    return data;\r\n  }\r\n\r\n  public static readTags(\r\n    file: DataView,\r\n    tiffStart: number,\r\n    dirStart: number,\r\n    strings: string[],\r\n    bigEnd: boolean\r\n  ): Object {\r\n    let entries: number = file.getUint16(dirStart, !bigEnd);\r\n    let tags: any = {};\r\n    let entryOffset: number;\r\n    let tag: string;\r\n\r\n    for (let i = 0; i < entries; i++) {\r\n      entryOffset = dirStart + i * 12 + 2;\r\n      tag = strings[file.getUint16(entryOffset, !bigEnd)];\r\n      if (!tag) {\r\n        Debug.log(\"Unknown tag: \" + file.getUint16(entryOffset, !bigEnd));\r\n      }\r\n      tags[tag] = Exif.readTagValue(\r\n        file,\r\n        entryOffset,\r\n        tiffStart,\r\n        dirStart,\r\n        bigEnd\r\n      );\r\n    }\r\n    return tags;\r\n  }\r\n\r\n  public static readTagValue(\r\n    file: any,\r\n    entryOffset: number,\r\n    tiffStart: number,\r\n    dirStart: number,\r\n    bigEnd: boolean\r\n  ): any {\r\n    let type: number = file.getUint16(entryOffset + 2, !bigEnd);\r\n    let numValues = file.getUint32(entryOffset + 4, !bigEnd);\r\n    let valueOffset = file.getUint32(entryOffset + 8, !bigEnd) + tiffStart;\r\n    let offset: number;\r\n    let vals: any[], val: any, n: number;\r\n    let numerator: any;\r\n    let denominator: any;\r\n\r\n    switch (type) {\r\n      case 1: // byte, 8-bit unsigned int\r\n      case 7: // undefined, 8-bit byte, value depending on field\r\n        if (numValues === 1) {\r\n          return file.getUint8(entryOffset + 8, !bigEnd);\r\n        } else {\r\n          offset = numValues > 4 ? valueOffset : entryOffset + 8;\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            vals[n] = file.getUint8(offset + n);\r\n          }\r\n          return vals;\r\n        }\r\n\r\n      case 2: // ascii, 8-bit byte\r\n        offset = numValues > 4 ? valueOffset : entryOffset + 8;\r\n        return Exif.getStringFromDB(file, offset, numValues - 1);\r\n\r\n      case 3: // short, 16 bit int\r\n        if (numValues === 1) {\r\n          return file.getUint16(entryOffset + 8, !bigEnd);\r\n        } else {\r\n          offset = numValues > 2 ? valueOffset : entryOffset + 8;\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            vals[n] = file.getUint16(offset + 2 * n, !bigEnd);\r\n          }\r\n          return vals;\r\n        }\r\n\r\n      case 4: // long, 32 bit int\r\n        if (numValues === 1) {\r\n          return file.getUint32(entryOffset + 8, !bigEnd);\r\n        } else {\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            vals[n] = file.getUint32(valueOffset + 4 * n, !bigEnd);\r\n          }\r\n          return vals;\r\n        }\r\n\r\n      case 5: // rational = two long values, first is numerator, second is denominator\r\n        if (numValues === 1) {\r\n          numerator = file.getUint32(valueOffset, !bigEnd);\r\n          denominator = file.getUint32(valueOffset + 4, !bigEnd);\r\n          val = new Fraction(numerator / denominator);\r\n          val.numerator = numerator;\r\n          val.denominator = denominator;\r\n          return val;\r\n        } else {\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            numerator = file.getUint32(valueOffset + 8 * n, !bigEnd);\r\n            denominator = file.getUint32(valueOffset + 4 + 8 * n, !bigEnd);\r\n            vals[n] = new Fraction(numerator / denominator);\r\n            vals[n].numerator = numerator;\r\n            vals[n].denominator = denominator;\r\n          }\r\n          return vals;\r\n        }\r\n\r\n      case 9: // slong, 32 bit signed int\r\n        if (numValues === 1) {\r\n          return file.getInt32(entryOffset + 8, !bigEnd);\r\n        } else {\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            vals[n] = file.getInt32(valueOffset + 4 * n, !bigEnd);\r\n          }\r\n          return vals;\r\n        }\r\n\r\n      case 10: // signed rational, two slongs, first is numerator, second is denominator\r\n        if (numValues === 1) {\r\n          return (\r\n            file.getInt32(valueOffset, !bigEnd) /\r\n            file.getInt32(valueOffset + 4, !bigEnd)\r\n          );\r\n        } else {\r\n          vals = [];\r\n          for (n = 0; n < numValues; n++) {\r\n            vals[n] =\r\n              file.getInt32(valueOffset + 8 * n, !bigEnd) /\r\n              file.getInt32(valueOffset + 4 + 8 * n, !bigEnd);\r\n          }\r\n          return vals;\r\n        }\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  public static getStringFromDB(\r\n    buffer: DataView,\r\n    start: number,\r\n    length: number\r\n  ): string {\r\n    let outstr = \"\";\r\n    for (let n = start; n < start + length; n++) {\r\n      outstr += String.fromCharCode(buffer.getUint8(n));\r\n    }\r\n    return outstr;\r\n  }\r\n\r\n  public static readEXIFData(file: DataView, start: number): any {\r\n    if (Exif.getStringFromDB(file, start, 4) !== \"Exif\") {\r\n      Debug.log(\"Not valid EXIF data! \" + Exif.getStringFromDB(file, start, 4));\r\n\r\n      return false;\r\n    }\r\n\r\n    let bigEnd: boolean,\r\n      tags: any,\r\n      tag: string,\r\n      exifData: any,\r\n      gpsData: any,\r\n      tiffOffset: number = start + 6;\r\n\r\n    // test for TIFF validity and endianness\r\n    if (file.getUint16(tiffOffset) === 0x4949) {\r\n      bigEnd = false;\r\n    } else {\r\n      if (file.getUint16(tiffOffset) === 0x4d4d) {\r\n        bigEnd = true;\r\n      } else {\r\n        Debug.log(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (file.getUint16(tiffOffset + 2, !bigEnd) !== 0x002a) {\r\n      Debug.log(\"Not valid TIFF data! (no 0x002A)\");\r\n      return false;\r\n    }\r\n\r\n    let firstIFDOffset = file.getUint32(tiffOffset + 4, !bigEnd);\r\n\r\n    if (firstIFDOffset < 0x00000008) {\r\n      Debug.log(\r\n        \"Not valid TIFF data! (First offset less than 8)\",\r\n        file.getUint32(tiffOffset + 4, !bigEnd)\r\n      );\r\n      return false;\r\n    }\r\n\r\n    tags = Exif.readTags(\r\n      file,\r\n      tiffOffset,\r\n      tiffOffset + firstIFDOffset,\r\n      Exif.TiffTags,\r\n      bigEnd\r\n    );\r\n\r\n    if (tags.ExifIFDPointer) {\r\n      exifData = Exif.readTags(\r\n        file,\r\n        tiffOffset,\r\n        tiffOffset + tags.ExifIFDPointer,\r\n        Exif.Tags,\r\n        bigEnd\r\n      );\r\n      for (tag in exifData) {\r\n        if ({}.hasOwnProperty.call(exifData, tag)) {\r\n          switch (tag) {\r\n            case \"LightSource\":\r\n            case \"Flash\":\r\n            case \"MeteringMode\":\r\n            case \"ExposureProgram\":\r\n            case \"SensingMethod\":\r\n            case \"SceneCaptureType\":\r\n            case \"SceneType\":\r\n            case \"CustomRendered\":\r\n            case \"WhiteBalance\":\r\n            case \"GainControl\":\r\n            case \"Contrast\":\r\n            case \"Saturation\":\r\n            case \"Sharpness\":\r\n            case \"SubjectDistanceRange\":\r\n            case \"FileSource\":\r\n              exifData[tag] = Exif.StringValues[tag][exifData[tag]];\r\n              break;\r\n            case \"ExifVersion\":\r\n            case \"FlashpixVersion\":\r\n              exifData[tag] = String.fromCharCode(\r\n                exifData[tag][0],\r\n                exifData[tag][1],\r\n                exifData[tag][2],\r\n                exifData[tag][3]\r\n              );\r\n              break;\r\n            case \"ComponentsConfiguration\":\r\n              let compopents = \"Components\";\r\n              exifData[tag] =\r\n                Exif.StringValues[compopents][exifData[tag][0]] +\r\n                Exif.StringValues[compopents][exifData[tag][1]] +\r\n                Exif.StringValues[compopents][exifData[tag][2]] +\r\n                Exif.StringValues[compopents][exifData[tag][3]];\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          tags[tag] = exifData[tag];\r\n        }\r\n      }\r\n    }\r\n\r\n    if (tags.GPSInfoIFDPointer) {\r\n      gpsData = Exif.readTags(\r\n        file,\r\n        tiffOffset,\r\n        tiffOffset + tags.GPSInfoIFDPointer,\r\n        Exif.GPSTags,\r\n        bigEnd\r\n      );\r\n      for (tag in gpsData) {\r\n        if ({}.hasOwnProperty.call(gpsData, tag)) {\r\n          switch (tag) {\r\n            case \"GPSVersionID\":\r\n              gpsData[tag] =\r\n                gpsData[tag][0] +\r\n                \".\" +\r\n                gpsData[tag][1] +\r\n                \".\" +\r\n                gpsData[tag][2] +\r\n                \".\" +\r\n                gpsData[tag][3];\r\n              break;\r\n            default:\r\n              break;\r\n          }\r\n          tags[tag] = gpsData[tag];\r\n        }\r\n      }\r\n    }\r\n\r\n    return tags;\r\n  }\r\n\r\n  //   get rid of this silly issue\r\n  private static checkImageType(img: any) {\r\n    return img instanceof Image || img instanceof HTMLImageElement;\r\n  }\r\n\r\n  public static getData(\r\n    img: IImageExtended | HTMLImageElement,\r\n    callback: Function\r\n  ) {\r\n    if (this.checkImageType(img) && !img.complete) {\r\n      return false;\r\n    }\r\n\r\n    if (!Exif.imageHasData(img as IImageExtended)) {\r\n      Exif.getImageData(img as IImageExtended, callback);\r\n    } else {\r\n      if (callback) {\r\n        callback.call(img);\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  public static getTag(img: any, tag: string) {\r\n    if (!Exif.imageHasData(img)) {\r\n      return;\r\n    }\r\n    return img.exifdata[tag];\r\n  }\r\n\r\n  public static getAllTags(img: any) {\r\n    if (!Exif.imageHasData(img)) {\r\n      return {};\r\n    }\r\n    let a: string,\r\n      data: any = img.exifdata,\r\n      tags: any = {};\r\n    for (a in data) {\r\n      if (data.hasOwnProperty(a)) {\r\n        tags[a] = data[a];\r\n      }\r\n    }\r\n    return tags;\r\n  }\r\n\r\n  public static pretty(img: IImageExtended) {\r\n    if (!Exif.imageHasData(img)) {\r\n      return \"\";\r\n    }\r\n    let a: any,\r\n      data: any = img.exifdata,\r\n      strPretty = \"\";\r\n    for (a in data) {\r\n      if (data.hasOwnProperty(a)) {\r\n        if (typeof data[a] === \"object\") {\r\n          if (data[a] instanceof Number) {\r\n            strPretty += `${a} : ${data[a]} [${data[a].numerator}/${\r\n              data[a].denominator\r\n            }]\\r\\n`;\r\n          } else {\r\n            strPretty += `${a} : [${data[a].length} values]\\r\\n`;\r\n          }\r\n        } else {\r\n          strPretty += `${a} : ${data[a]}\\r\\n`;\r\n        }\r\n      }\r\n    }\r\n    return strPretty;\r\n  }\r\n\r\n  public static readFromBinaryFile(file: ArrayBuffer) {\r\n    return Exif.findEXIFinJPEG(file);\r\n  }\r\n}\r\n"]}