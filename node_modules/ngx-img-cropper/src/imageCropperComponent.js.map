{"version":3,"file":"imageCropperComponent.js","sourceRoot":"","sources":["../../src/imageCropperComponent.ts"],"names":[],"mappings":"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","sourcesContent":["import {\r\n  Component,\r\n  Input,\r\n  Renderer2,\r\n  ViewChild,\r\n  ElementRef,\r\n  Output,\r\n  EventEmitter,\r\n  Type,\r\n  AfterViewInit,\r\n  OnChanges,\r\n  OnDestroy,\r\n  SimpleChanges\r\n} from \"@angular/core\";\r\nimport { ImageCropper } from \"./imageCropper\";\r\nimport { CropperSettings } from \"./cropperSettings\";\r\nimport { Exif } from \"./exif\";\r\nimport { Bounds } from \"./model/bounds\";\r\nimport { CropPosition } from \"./model/cropPosition\";\r\n\r\n@Component({\r\n  selector: \"img-cropper\",\r\n  template: `\r\n        <span class=\"ng2-imgcrop\">\r\n          <input *ngIf=\"!settings.noFileInput\" #fileInput type=\"file\" accept=\"image/*\" (change)=\"fileChangeListener($event)\">\r\n          <canvas #cropcanvas\r\n                  (mousedown)=\"onMouseDown($event)\"\r\n                  (mouseup)=\"onMouseUp($event)\"\r\n                  (mousemove)=\"onMouseMove($event)\"\r\n                  (mouseleave)=\"onMouseUp($event)\"\r\n                  (touchmove)=\"onTouchMove($event)\"\r\n                  (touchend)=\"onTouchEnd($event)\"\r\n                  (touchstart)=\"onTouchStart($event)\">\r\n          </canvas>\r\n        </span>\r\n      `\r\n})\r\nexport class ImageCropperComponent\r\n  implements AfterViewInit, OnChanges, OnDestroy {\r\n  @ViewChild(\"cropcanvas\", undefined)\r\n  cropcanvas: ElementRef;\r\n  @ViewChild(\"fileInput\") fileInput: ElementRef;\r\n\r\n  @Input(\"settings\") public settings: CropperSettings;\r\n  @Input(\"image\") public image: any;\r\n  @Input(\"inputImage\") public inputImage: any;\r\n  @Input() public cropper: ImageCropper;\r\n  @Input() public cropPosition: CropPosition;\r\n  @Output()\r\n  public cropPositionChange: EventEmitter<CropPosition> = new EventEmitter<\r\n    CropPosition\r\n  >();\r\n\r\n  @Output() public onCrop: EventEmitter<any> = new EventEmitter();\r\n  @Output() imageSet: EventEmitter<boolean> = new EventEmitter<boolean>();\r\n\r\n  public croppedWidth: number;\r\n  public croppedHeight: number;\r\n  public intervalRef: number;\r\n  public raf: number;\r\n  public renderer: Renderer2;\r\n  public windowListener: EventListenerObject;\r\n\r\n  private isCropPositionUpdateNeeded: boolean;\r\n\r\n  constructor(renderer: Renderer2) {\r\n    this.renderer = renderer;\r\n  }\r\n\r\n  public ngAfterViewInit(): void {\r\n    let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\r\n\r\n    if (!this.settings) {\r\n      this.settings = new CropperSettings();\r\n    }\r\n\r\n    if (this.settings.cropperClass) {\r\n      this.renderer.setAttribute(canvas, \"class\", this.settings.cropperClass);\r\n    }\r\n\r\n    if (!this.settings.dynamicSizing) {\r\n      this.renderer.setAttribute(\r\n        canvas,\r\n        \"width\",\r\n        this.settings.canvasWidth.toString()\r\n      );\r\n      this.renderer.setAttribute(\r\n        canvas,\r\n        \"height\",\r\n        this.settings.canvasHeight.toString()\r\n      );\r\n    } else {\r\n      this.windowListener = this.resize.bind(this);\r\n      window.addEventListener(\"resize\", this.windowListener);\r\n    }\r\n\r\n    if (!this.cropper) {\r\n      this.cropper = new ImageCropper(this.settings);\r\n    }\r\n\r\n    this.cropper.prepare(canvas);\r\n  }\r\n\r\n  public ngOnChanges(changes: SimpleChanges): void {\r\n    if (this.isCropPositionChanged(changes)) {\r\n      this.cropper.updateCropPosition(this.cropPosition.toBounds());\r\n      if (this.cropper.isImageSet()) {\r\n        let bounds = this.cropper.getCropBounds();\r\n        this.image.image = this.cropper.getCroppedImageHelper().src;\r\n        this.onCrop.emit(bounds);\r\n      }\r\n      this.updateCropBounds();\r\n    }\r\n\r\n    if (changes.inputImage) {\r\n      this.setImage(changes.inputImage.currentValue);\r\n    }\r\n\r\n    if (changes.settings && this.cropper && this.cropper.isImageSet()) {\r\n      this.cropper.updateSettings(this.settings);\r\n      this.image.image = this.cropper.getCroppedImageHelper().src;\r\n      this.onCrop.emit(this.cropper.getCropBounds());\r\n    }\r\n  }\r\n\r\n  public ngOnDestroy() {\r\n    if (this.settings.dynamicSizing && this.windowListener) {\r\n      window.removeEventListener(\"resize\", this.windowListener);\r\n    }\r\n  }\r\n\r\n  public onTouchMove(event: TouchEvent): void {\r\n    this.cropper.onTouchMove(event);\r\n  }\r\n\r\n  public onTouchStart(event: TouchEvent): void {\r\n    this.cropper.onTouchStart(event);\r\n  }\r\n\r\n  public onTouchEnd(event: TouchEvent): void {\r\n    this.cropper.onTouchEnd(event);\r\n    if (this.cropper.isImageSet()) {\r\n      this.image.image = this.cropper.getCroppedImageHelper().src;\r\n      this.onCrop.emit(this.cropper.getCropBounds());\r\n      this.updateCropBounds();\r\n    }\r\n  }\r\n\r\n  public onMouseDown(event: MouseEvent): void {\r\n    this.cropper.onMouseDown(event);\r\n    // if (!this.cropper.isImageSet() && !this.settings.noFileInput) {\r\n    //   // load img\r\n    //   this.fileInput.nativeElement.click();\r\n    // }\r\n  }\r\n\r\n  public onMouseUp(event: MouseEvent): void {\r\n    if (this.cropper.isImageSet()) {\r\n      this.cropper.onMouseUp(event);\r\n      this.image.image = this.cropper.getCroppedImageHelper().src;\r\n      this.onCrop.emit(this.cropper.getCropBounds());\r\n      this.updateCropBounds();\r\n    }\r\n  }\r\n\r\n  public onMouseMove(event: MouseEvent): void {\r\n    this.cropper.onMouseMove(event);\r\n  }\r\n\r\n  public fileChangeListener($event: any) {\r\n    if ($event.target.files.length === 0) return;\r\n\r\n    let file: File = $event.target.files[0];\r\n    if (this.settings.allowedFilesRegex.test(file.name)) {\r\n      let image: any = new Image();\r\n      let fileReader: FileReader = new FileReader();\r\n\r\n      fileReader.addEventListener(\"loadend\", (loadEvent: any) => {\r\n        image.addEventListener(\"load\", () => {\r\n          this.setImage(image);\r\n        });\r\n        image.src = loadEvent.target.result;\r\n      });\r\n\r\n      fileReader.readAsDataURL(file);\r\n    }\r\n  }\r\n\r\n  private resize() {\r\n    let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\r\n    this.settings.canvasWidth = canvas.offsetWidth;\r\n    this.settings.canvasHeight = canvas.offsetHeight;\r\n    this.cropper.resizeCanvas(canvas.offsetWidth, canvas.offsetHeight, true);\r\n  }\r\n\r\n  public reset(): void {\r\n    this.cropper.reset();\r\n    this.renderer.setAttribute(\r\n      this.cropcanvas.nativeElement,\r\n      \"class\",\r\n      this.settings.cropperClass\r\n    );\r\n    this.image.image = this.cropper.getCroppedImageHelper().src;\r\n  }\r\n\r\n  public setImage(image: HTMLImageElement, newBounds: any = null) {\r\n    this.imageSet.emit(true);\r\n    this.renderer.setAttribute(\r\n      this.cropcanvas.nativeElement,\r\n      \"class\",\r\n      `${this.settings.cropperClass} ${this.settings.croppingClass}`\r\n    );\r\n    this.raf = window.requestAnimationFrame(() => {\r\n      if (this.raf) {\r\n        window.cancelAnimationFrame(this.raf);\r\n      }\r\n      if (image.naturalHeight > 0 && image.naturalWidth > 0) {\r\n        image.height = image.naturalHeight;\r\n        image.width = image.naturalWidth;\r\n\r\n        window.cancelAnimationFrame(this.raf);\r\n        this.getOrientedImage(image, (img: HTMLImageElement) => {\r\n          if (this.settings.dynamicSizing) {\r\n            let canvas: HTMLCanvasElement = this.cropcanvas.nativeElement;\r\n            this.settings.canvasWidth = canvas.offsetWidth;\r\n            this.settings.canvasHeight = canvas.offsetHeight;\r\n            this.cropper.resizeCanvas(\r\n              canvas.offsetWidth,\r\n              canvas.offsetHeight,\r\n              false\r\n            );\r\n          }\r\n\r\n          this.cropper.setImage(img);\r\n          if (this.cropPosition && this.cropPosition.isInitialized()) {\r\n            this.cropper.updateCropPosition(this.cropPosition.toBounds());\r\n          }\r\n\r\n          this.image.original = img;\r\n          let bounds = this.cropper.getCropBounds();\r\n          this.image.image = this.cropper.getCroppedImageHelper().src;\r\n\r\n          if (!this.image) {\r\n            this.image = image;\r\n          }\r\n\r\n          if (newBounds != null) {\r\n            bounds = newBounds;\r\n            this.cropper.setBounds(bounds);\r\n            this.cropper.updateCropPosition(bounds);\r\n          }\r\n          this.onCrop.emit(bounds);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private isCropPositionChanged(changes: SimpleChanges): boolean {\r\n    if (\r\n      this.cropper &&\r\n      changes[\"cropPosition\"] &&\r\n      this.isCropPositionUpdateNeeded\r\n    ) {\r\n      return true;\r\n    } else {\r\n      this.isCropPositionUpdateNeeded = true;\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private updateCropBounds(): void {\r\n    let cropBound: Bounds = this.cropper.getCropBounds();\r\n    this.cropPositionChange.emit(\r\n      new CropPosition(\r\n        cropBound.left,\r\n        cropBound.top,\r\n        cropBound.width,\r\n        cropBound.height\r\n      )\r\n    );\r\n    this.isCropPositionUpdateNeeded = false;\r\n  }\r\n\r\n  private getOrientedImage(image: HTMLImageElement, callback: Function) {\r\n    let img: any;\r\n\r\n    Exif.getData(image, function() {\r\n      let orientation = Exif.getTag(image, \"Orientation\");\r\n\r\n      if ([3, 6, 8].indexOf(orientation) > -1) {\r\n        let canvas: HTMLCanvasElement = document.createElement(\"canvas\"),\r\n          ctx: CanvasRenderingContext2D = <CanvasRenderingContext2D>canvas.getContext(\r\n            \"2d\"\r\n          ),\r\n          cw: number = image.width,\r\n          ch: number = image.height,\r\n          cx: number = 0,\r\n          cy: number = 0,\r\n          deg: number = 0;\r\n\r\n        switch (orientation) {\r\n          case 3:\r\n            cx = -image.width;\r\n            cy = -image.height;\r\n            deg = 180;\r\n            break;\r\n          case 6:\r\n            cw = image.height;\r\n            ch = image.width;\r\n            cy = -image.height;\r\n            deg = 90;\r\n            break;\r\n          case 8:\r\n            cw = image.height;\r\n            ch = image.width;\r\n            cx = -image.width;\r\n            deg = 270;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n\r\n        canvas.width = cw;\r\n        canvas.height = ch;\r\n        ctx.rotate(deg * Math.PI / 180);\r\n        ctx.drawImage(image, cx, cy);\r\n        img = document.createElement(\"img\");\r\n        img.width = cw;\r\n        img.height = ch;\r\n        img.addEventListener(\"load\", function() {\r\n          callback(img);\r\n        });\r\n        img.src = canvas.toDataURL(\"image/png\");\r\n      } else {\r\n        img = image;\r\n        callback(img);\r\n      }\r\n    });\r\n  }\r\n}\r\n"]}